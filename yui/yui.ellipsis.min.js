/**
* Ellipsis plugin (YUI) - For when text is too l ...
*
* @fileOverview  A slightly smarter way of truncating text
* @author        Dan Beam <dan@danbeam.org>
* @param         {object} conf - configuration objects to override the defaults
* @return        {Node} the Node passed to the method
*
* Copyright (c) 2010 Dan Beam
* Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
*/
;YUI.add("ellipsis",function(Y){Y.DOM.ellipsis=function(node,conf){conf=conf||{};Y.mix(conf,{"ellipsis":" ...","fudge":3,"lines":1});var yEl=Y.one(node),originalText=yEl.getAttribute("originalText")||yEl.get("text"),currentLength=originalText.length,charIncrement=currentLength,clone=Y.one(document.createElement(yEl.get("nodeName"))),lineHeight,targetHeight,currentHeight;clone.setStyles({"overflow":"hidden","position":"absolute","visibility":"hidden","display":"block","bottom":"-10px","right":"-10px","width":yEl.getComputedStyle("width"),"fontSize":yEl.getComputedStyle("fontSize"),"fontFamily":yEl.getComputedStyle("fontFamily"),"fontWeight":yEl.getComputedStyle("fontWeight"),"letterSpacing":yEl.getComputedStyle("letterSpacing"),"lineHeight":yEl.getComputedStyle("lineHeight")});clone.set("text","some sample text");Y.one("body").append(clone);lineHeight=parseInt(clone.getComputedStyle("height"));clone.setStyle("overflow","visible");targetHeight=conf.lines*lineHeight;clone.set("text",originalText);currentHeight=parseInt(clone.getComputedStyle("height"));if(currentHeight<=targetHeight&&originalText.length===yEl.get("text").length){clone.remove();return;}for(var lastKnownGood;charIncrement>=1;){charIncrement=Math.floor(charIncrement/2);currentLength+=currentHeight>targetHeight?-charIncrement:+charIncrement;clone.set("text",originalText.slice(0,currentLength-conf.ellipsis.length)+conf.ellipsis);currentHeight=parseInt(clone.getComputedStyle("height"));if(currentHeight<=targetHeight){lastKnownGood=currentLength;}}clone.remove();if(!yEl.getAttribute("originalText")){yEl.setAttribute("originalText",originalText);}if(originalText.length===(clone.get("text").length-conf.ellipsis.length)){yEl.set("text",originalText);}else{if("undefined"!==typeof lastKnownGood){yEl.set("text",originalText.slice(0,lastKnownGood-conf.ellipsis.length-conf.fudge)+conf.ellipsis);}}return yEl;};Y.Node.importMethod(Y.DOM,"ellipsis");Y.NodeList.importMethod(Y.Node.prototype,"ellipsis");},"0.0.1",{"requires":["base","node"]});