(function(a){a.fn.ellipsis=function(b){b=a.extend({ellipsis:" ...",fudge:0,lines:1},b||{});return this.each(function(){var k=a(this),e=k.attr("originalText")||k.text(),f=e.length,d=f,i=a(document.createElement(k[0].nodeName)),j,g,c;i.css({overflow:"hidden",position:"absolute",visibility:"hidden",bottom:"-10px",right:"-10px",display:"block",width:k.css("width"),fontSize:k.css("font-size"),fontFamily:k.css("font-family"),fontWeight:k.css("font-weight"),letterSpacing:k.css("letter-spacing"),lineHeight:k.css("line-height")});i.text("some sample text");a("body").append(i);j=i.height();i.css("overflow","visible");g=b.lines*j;i.text(e);c=i.height();if(c<=g){i.remove();return;}for(var h;d>=1;){d=Math.floor(d/2);f+=c>g?-d:+d;i.text(e.slice(0,f-b.ellipsis.length)+b.ellipsis);c=i.height();if(c<=g){h=f;}}i.remove();if(!k.attr("originalText")){k.attr("originalText",e);}k.text(e.slice(0,h-b.ellipsis.length-b.fudge)+b.ellipsis);});};})(jQuery);