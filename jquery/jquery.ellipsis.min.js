(function($){$.fn.ellipsis=function(conf){conf=$.extend({"ellipsis":" ...","fudge":0,"lines":1},conf||{});return this.each(function(){var $el=$(this),originalText=$el.attr("originalText")||$el.text(),currentLength=originalText.length,charIncrement=currentLength,clone=$(document.createElement($el[0].nodeName)),lineHeight,targetHeight,currentHeight;clone.css({"overflow":"hidden","position":"absolute","visibility":"hidden","bottom":"-10px","right":"-10px","display":"block","width":$el.css("width"),"fontSize":$el.css("font-size"),"fontFamily":$el.css("font-family"),"fontWeight":$el.css("font-weight"),"letterSpacing":$el.css("letter-spacing"),"lineHeight":$el.css("line-height")});clone.text("some sample text");$("body").append(clone);lineHeight=clone.height();clone.css("overflow","visible");targetHeight=conf.lines*lineHeight;clone.text(originalText);currentHeight=clone.height();if(currentHeight<=targetHeight){clone.remove();return;}for(var lastKnownGood;charIncrement>=1;){charIncrement=Math.floor(charIncrement/2);currentLength+=currentHeight>targetHeight?-charIncrement:+charIncrement;clone.text(originalText.slice(0,currentLength-conf.ellipsis.length)+conf.ellipsis);currentHeight=clone.height();if(currentHeight<=targetHeight){lastKnownGood=currentLength;}}clone.remove();if(!$el.attr("originalText")){$el.attr("originalText",originalText);}$el.text(originalText.slice(0,lastKnownGood-conf.ellipsis.length-conf.fudge)+conf.ellipsis);});};})(jQuery);