/**
* Ellipsis plugin (jQuery) - For when text is too l ...
*
* @fileOverview  A slightly smarter way of truncating text
* @author        Dan Beam <dan@danbeam.org>
* @param         {object} conf - configuration objects to override the defaults
* @return        {jQuery} an instance of jQuery with the original nodes
*
* Copyright (c) 2010 Dan Beam
* Licensed under the MIT License: http://www.opensource.org/licenses/mit-license.php
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
*/
;(function($){$.fn.ellipsis=function(conf){conf=$.extend({"ellipsis":" ...","fudge":3,"lines":1},conf||{});return this.each(function(){var $el=$(this),originalText=$el.attr("originalText")||$el.text(),currentLength=originalText.length,charIncrement=currentLength,clone=$(document.createElement($el[0].nodeName)),lineHeight,targetHeight,currentHeight;clone.css({"overflow":"hidden","position":"absolute","visibility":"hidden","bottom":"-10px","right":"-10px","display":"block","width":$el.css("width"),"fontSize":$el.css("font-size"),"fontFamily":$el.css("font-family"),"fontWeight":$el.css("font-weight"),"letterSpacing":$el.css("letter-spacing"),"lineHeight":$el.css("line-height")});clone.text("some sample text");$("body").append(clone);lineHeight=clone.height();clone.css("overflow","visible");targetHeight=conf.lines*lineHeight;clone.text(originalText);currentHeight=clone.height();if(currentHeight<=targetHeight&&originalText.length===$el.text().length){clone.remove();return;}for(var lastKnownGood;charIncrement>=1;){charIncrement=Math.floor(charIncrement/2);currentLength+=currentHeight>targetHeight?-charIncrement:+charIncrement;clone.text(originalText.slice(0,currentLength-conf.ellipsis.length)+conf.ellipsis);currentHeight=clone.height();if(currentHeight<=targetHeight){lastKnownGood=currentLength;}}clone.remove();if(!$el.attr("originalText")){$el.attr("originalText",originalText);}if(originalText.length===(clone.text().length-conf.ellipsis.length)){$el.text(originalText);}else{if("undefined"!==typeof lastKnownGood){$el.text(originalText.slice(0,lastKnownGood-conf.ellipsis.length-conf.fudge)+conf.ellipsis);}}});};})(jQuery);