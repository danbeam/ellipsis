(function(a){a.fn.ellipsis=function(b){b=a.extend({ellipsis:" ...",fudge:0,lines:1},b||{});return this.each(function(){var f=a(this),c=b.lines*(parseInt(f.css("line-height"))||(parseInt(f.css("font-size"))+3)),i=f.attr("originalText")||f.text(),e=i.length,d=e,j=a(document.createElement(f[0].nodeName)),h;j.css({position:"absolute",visibility:"hidden",bottom:"-10px",right:"-10px",width:f.css("width"),fontSize:f.css("font-size"),fontFamily:f.css("font-family"),fontWeight:f.css("font-weight"),letterSpacing:f.css("letter-spacing"),lineHeight:f.css("line-height")});j.text(i);a("body").append(j);h=j.height();if(h<=c){j.remove();return;}for(var g;d>=1;){d=Math.floor(d/2);e+=h>c?-d:+d;j.text(i.slice(0,e-b.ellipsis.length)+b.ellipsis);h=j.height();if(h<=c){g=e;}}j.remove();if(!f.attr("originalText")){f.attr("originalText",i);}f.text(i.slice(0,g-b.ellipsis.length-b.fudge)+b.ellipsis);});};})(jQuery);